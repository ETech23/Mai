<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="og:title" content="Mai AI Token" />
  <meta property="og:description" content="Join the project today and get rewarded with digital money; Mai Crypto Token." />
  <meta property="og:image" content="https://www.maichain.site/social/MaiLogo175.png" />
  <meta property="og:url" content="https://www.maichain.site" />
  <meta property="og:type" content="website" />
  <title>MAI AI and Token Mining Platform</title>
  <!-- Tailwind CSS CDN -->
  <link href="output.css" rel="stylesheet">
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="./social/MaiLogo175.png" type="image/png">
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    /* Custom styles that complement Tailwind */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', sans-serif;
      background: #121212;
      color: #fff;
      transition: all 0.3s ease;
    }
    
    .mining-sphere {
      position: relative;
      width: 180px;
      height: 180px;
      border-radius: 50%;
      background: linear-gradient(145deg, #1a1a1a, #282828);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5), 
                  inset 0 4px 16px rgba(255, 255, 255, 0.1),
                  inset 0 -4px 16px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      transition: all 0.5s ease;
    }
    
    .mining-sphere::before {
      content: '';
      position: absolute;
      width: 120%;
      height: 120%;
      background: radial-gradient(
        circle at center,
        rgba(76, 175, 80, 0.3) 0%,
        rgba(76, 175, 80, 0.1) 40%,
        transparent 70%
      );
      animation: pulse 2s ease-in-out infinite;
    }
    
    .mining-sphere::after {
      content: '';
      position: absolute;
      top: -10px;
      left: 30%;
      width: 40%;
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      filter: blur(5px);
    }
    
    .mining-sphere p {
      position: relative;
      z-index: 2;
      font-weight: 700;
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 0 2px 10px rgba(76, 175, 80, 0.5);
    }
    
    @keyframes pulse {
      0%, 100% {
        opacity: 0.7;
        transform: scale(1);
      }
      50% {
        opacity: 0.9;
        transform: scale(1.05);
      }
    }
    
    /* Preserve .hidden class for your existing JavaScript */
    .hidden {
      display: none !important;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #1a1a1a;
    }
    ::-webkit-scrollbar-thumb {
      background: #3d3d3d;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #4caf50;
    }
    
    /* Mining activation pulse */
    .mining-active .mining-sphere {
      box-shadow: 0 0 30px rgba(76, 175, 80, 0.5),
                  inset 0 4px 16px rgba(76, 175, 80, 0.2),
                  inset 0 -4px 16px rgba(0, 0, 0, 0.3);
    }
    
    /* Button hover effect */
    button:not(:disabled):hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }
  
  /*User Info Dropdown */
  
#user-info-dropdown {
  
  
  left: 0;
  
  
  
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  
  display: none;
  
  text-align: left;
  transition: transform 0.2s ease-in-out!important;
  
  
  
  }

#user-info-dropdown.active {
  display: block;
}

#user-info-dropdown i {
  min-width: 25px;
  max-width: 25px;
  text-decoration: none;
  color: darkgreen;
}
#user-info-dropdown p {
  display: flex;
  align-items: center;
  font-size: 1rem;
  color: white;
  gap: 5px;
  margin: 8px 0;
  padding: 10px 0;
  border-bottom: 1px solid #f0f0f0;
}
#user-info-dropdown p:last-child {
  border-bottom: none;
}

#user-info-dropdown a {
  color: darkgreen;
  text-decoration: none;
  word-wrap: break-word;
}

#user-info-dropdown a:hover {
  text-decoration: underline;
}
  #user-info-dropdown {
  animation: dropdownFadeIn 0.6s ease-out forwards; /* Adjust duration and easing */
  op acity: 0; /* Ensure it's hidden initially */
  transform: translateY(-20px); /* Initial state before animation triggers */
}

/* Active state triggers animation */
#user-info-dropdown.active {
  animation: dropdownFadeIn 0.6s ease-out forwards; /* Ensure animation triggers on toggle */
  display: block;
}
  
  .task-button{
  position: fixed;
  bottom: 30px;
  right: 20px;
  background: linear-gradient(
    to right,
    #28a745,
    #232B3C,
    #FFD700,
    #0A101D,
    #28a745
  );
  backgroundcolor: #28a745; /* Green background */
  color: white;
  border: none;
  border-radius: 50%;
  width: 60px;
  height: 60px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
  font-size: 14px;
  font-weight: bold;
  cursor: pointer;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background-color 0.3s, transform 0.2s;
}

.task-button:hover {
  background-color: #218838; /* Darker green */
  transform: scale(1.1); /* Slight zoom effect */
}

.task-button:active {
  transform: scale(1); /* Reset zoom effect */
}
  
    /* Disable text selection */
    .no-select {
      user-select: none !important;
      -webkit-user-select: none !important;
      -ms-user-select: none !important;
      -moz-user-select: none !important;
    }
    /* Ensure buttons remain clickable */
    .no-select button,
    .no-select a {
      pointer-events: auto !important;
    }


 
    
/* Container for the notification icon */
.notification-icon {
  position: relative;
  display: inline-block;
  cursor: pointer;
}

/* Bell icon */
.bell {
  font-size: 17px; /* Adjust size as needed */
  display: inline-block; /* Required for animations */
}

/* Notification badge */
.badge {
  position: absolute;
  top: -5px;
  right: -10px;
  background-color: #FF4757; /* Red color for the badge */
  color: white;
  font-size: 12px;
  font-weight: bold;
  padding: 1px 3px;
  border-radius: 50%;
  display: none; /* Hidden by default */
}

/* Bell shake animation */
@keyframes shake {
  0%, 100% {
    transform: rotate(0deg);
  }
  10%, 30%, 50%, 70%, 90% {
    transform: rotate(-15deg);
  }
  20%, 40%, 60%, 80% {
    transform: rotate(15deg);
  }
}

/* Badge pulse animation */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.2);
  }
}

/* Class to enable shake animation */
.shake {
  animation: shake 1.5s infinite;
}

/* Class to enable pulse animation */
.pulse {
  animation: pulse 1.5s infinite;
}
  </style>
</head>
<body class="dark min-h-screen bg-gradient-to-b from-dark to-dark-200 text-gray-100 no-select">
  
   <!-- Preloader --
<div id="preloader" class="preloader hidden">
  <!-- Preloader animation or content --
  <p><img src="./img/mai_co.png" style="width: 200px; height: 200px"></p>
</div>
  <div id="news"></div> -->
  <!-- Toast notification system -->
  <div id="toast-container" class="fixed top-4 right-4 z-50 flex flex-col gap-2"></div>
  
  <!-- Theme toggle -->
  <button id="theme-toggle" class="fixed top-4 right-4 z-40 bg-dark-200 p-2 rounded-full shadow-lg text-gray-300 hover:text-white transition-all duration-300">
    <i class="fa-solid fa-moon"></i>
  </button>
  
  <!-- Install Button (Preserving original) -->
  <button id="install-button" class="hidden fixed top-20 right-4 z-40 bg-mining-accent text-white py-2 px-4 rounded-lg shadow-lg transition-all duration-300">
    <i class="fa-solid fa-download mr-2"></i>Install App
  </button>
  
  <!-- Main Dashboard -->
  <div class="dashboard hid den w-full min-h-screen flex flex-col" id="dashboard">
    <!-- Header Section -->
    <header class="bg-dark-100 border-b border-dark-300 p-4 shadow-md">
      <div class="container mx-auto">
        <div class="flex justify-between items-center">
          <!-- Menu Icon -->
          <div id="menu-icon" class="p-2 rounded-md bg-dark-200 hover:bg-dark-300 cursor-pointer transition-all text-xl ">
            <i class="fa-solid fa-bars"></i>
          
          </div>  
          
          <!-- Logo/Title -->
          <div class="text-center">
            <h1 class="text-2xl font-bold flex items-center justify-center">
              <span class="bg-clip-text text-transparent bg-gradient-to-r from-gold to-copper">MAI Chain</span>
            </h1>
          </div>
          
          <!-- POW Information -->
        <div class="mt-4 text-center">
          
          <p class="text-sm text-gray-400" id="display-username" style="display: none;"></p>
                        <div class="notification-icon">
  <span class="bell"><a href="news.html">ðŸ””</a></span>
  <span class="badge">0</span> <!-- Initial count is 0 -->
</div>
          
          <div id="dashboard" class="hid den">
  <h2><span id="display-username" class="hidden"></span></h2>
  <p>Bal: <span id="mined-balance"></span></p>
</div>

          <!-- Message Box -->
          <div class="message hidden mt-3 mx-auto max-w-lg bg-dark-200 border border-dark-300 rounded-lg p-3 text-sm text-gray-300" id="message-box">
            <!--  Your activities demonstrate your Proof of Work. The more mining tasks you complete, the greater your rewards.-->
          </div>
          
        </div>
          
          <!-- User Profile Section -->
          <div class="relative">
            <!--    <div class="w-10 h-10 rounded-full bg-dark-300 cursor-pointer flex items-center justify-center hover:bg-dark-200 transition-all" id="user-profile-trigger">
               <i class="fa-solid fa-user"></i>
              
            </div>-->
            <div " class="hidden">
        <p>Welcome, <span id="user-name">User</span></p>
        <p>Balance: <span id="mining-balance">0 MAI</span></p>
              <div id="progress-circle2"></div>
        <button id="logout-button">Log Out</button>
      </div>
            
            <!-- User Dropdown (keeping original ID) -->
            <div id="user-info-dropdown" class="hidden fixed max-h-[100vh] translate-x-0 overflow-scroll left-0 mt-0 w-56 bg-dark-100 rounded-lg shadow-xl border border-dark-300 p-4 z-30"> 
              <div class="flex flex-col gap-3">
                <div class="flex items-center gap-3 border-b border-dark-300 pb-3">
                  <div class="w-12 h-12 rounded-full bg-dark-300 flex items-center justify-center">
                    <i class="fa-solid fa-user text-xl"></i>
                  </div>
                  <div>
                    <p class="text-sm text-gray-400">Welcome,</p>
                    <p class="font-medium text-white" id="user-name">User</p>
                  </div>
                </div>
                
                <div class="pt-1">
                  <p class="text-sm text-gray-400">Current Balance</p>
                  <p class="font-bold text-xl text-gold" id="mining-balance">0 MAI</p>
                  <p class="text-xs text-gray-400">â‰ˆ $0.00 USD</p>
                </div>
                
                <button id="logout-button" class="mt-2 w-full bg-dark-300 hover:bg-red-900 text-white py-2 rounded-md transition-all flex items-center justify-center gap-2">
                  <i class="fa-solid fa-arrow-right-from-bracket"></i>
                  <span>Log Out</span>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        
      </div>
    </header>
    
    <!-- Main Content -->
    <main id="dynamic-content" class="mining-container flex-grow p-4 md:p-6">
      
      <div class="container mx-auto">
        <!-- Analytics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-0">
          <div class="bg-dark-100 rounded-xl shadow-lg p-4 border border-dark-300 ">
            <h3 class="text-sm text-gray-400 mb-1">Average Daily Earnings</h3>
            <p class="text-2xl font-bold text-white">11.45 <span class="text-gold text-lg">MAI</span></p>
            <div class="mt-2 h-1 w-full bg-dark-300 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-mining-green to-gold w-2/5 rounded-full"></div>
            </div>
          </div>
          </div>
        <div id="postMessage"></div>
        <!-- Mining Dashboard (preserving original ID) -->
        <div id="mining-dashboard" class="flex flex-col items-center justify-center gap-8 py-6 ">
          <!-- Mining Sphere (preserving original class) -->
          <div id="progress-circle" class="mining-sphere animate-float hid den mt-5">
            <p id="mined-balance" class="text-center">MAI</p>
          </div>
          
          
          <!--Notice-->
        <div id="notice" class="notice p-4 rounded-lg shadow-md border-l-4 border-yellow-500  hidden" style="background-color: #e5e7eb;">
  <div class="flex items-center gap-4">
    <!-- Icon -->
    <div class="text-yellow-700">
      <i class="fa-solid fa-bullhorn text-2xl"></i>
    </div>
    <!-- Content -->
    <div>
      <h3 class="text-lg font-semibold text-yellow-800">Important Update!</h3>
      <p class="text-sm text-yellow-700">
        
    Weâ€™re thrilled to announce a major update to <strong style="color: #fbbf24;">Maichain</strong> as part of our ongoing testing phase. To show our appreciation for your support and feedback, weâ€™ve <strong style="color: #fbbf24;">boosted</strong> the mining rate for all testers!
  <br>
        <a href="news.html#notice">Read more...</a>
      </p>
    </div>
  </div>
</div>
          
          <!-- Points Container (preserving original ID) -->
          <div id="points-container" class="bg-dark-100 rounded-lg px-6 py-3 shadow-lg border border-dark-300">
            <p class="flex items-center gap-2 text-lg">
              <i class="fa-regular fa-clock text-mining-green"></i>
                   <small id="dropdown-points" class="text-gray-400"></small>
              <span id="dashboard-points" class="text-mining-green font-medium">0.0 Points</span>
            </p>
          </div>
          
          <!-- Countdown Timer -->
          <p id="mining-countdown" class="text-xl font-medium text-center">Next session in: --:--:--</p>
          
          <!-- Mining Button -->
          <button id="activate-mining" class="bg-gradient-to-r from-mining-green to-mining-accent text-white py-3 px-5 rounded-full font-medium text-lg shadow-lg transform transition-all duration-300 hover:scale-105 flex items-center gap-1">
            <i class="fa-solid fa-bolt"></i>Activate Mining
          </button>
          
        </div>
        <p style="text-align: center; font-size: 10px">Learn blockchain concepts through simulated mining.</p>
        <div class="bg-dark-100 rounded-xl shadow-lg p-4 border border-dark-300">
  <h3 class="text-sm text-gray-400 mb-1">Network status</h3>
  <p class="text-lg font-medium text-white flex items-center">
    <span class="w-3 h-3 rounded-full bg-mining-green mr-2 animate-pulse"></span>
    Active
    <span class="ml-auto underline text-mining-green">
  <a href="token.html" style="color: #CCAA00;" class="flex items-center gap-1">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-dollar-sign">
      <line x1="12" y1="1" x2="12" y2="23"></line>
      <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
    </svg>
    Tokenomics
  </a>
</span>
  </p>
</div>
      </div>
      
      <div class="bg-dark-100 rounded-xl shadow-lg p-4 border border-dark-300">
            <h3 class="text-sm text-gray-400 mb-1">Mining Streak Level</h3>
            <p class="text-2xl font-bold text-white flex items-center">
              <span id="streak-level-container" class="flex"></span>
              <span class="text-sm text-gray-400 ml-2"></span>
            </p>
          </div>
      
      <button id="task-button" class="task-button">Updates</button>
    </main>
  </div>
  <div class="form-container hidden" id="form-container"></div>
  
    
     
    
    <script>
     // Retrieve the username from localStorage
    const username = localStorage.getItem("username");

    // Display the username
    const displayUsername = document.getElementById("display-username");
    if (username) {
      displayUsername.textContent = username;
    } else {
      displayUsername.textContent = "Guest"; // Fallback if no username is found
    }
  
  //toggle notice
    // Function to toggle the hidden class
function toggleVisibility() {
  const miningSphere = document.getElementById("progress-circle");
  const notice = document.getElementById("notice");

  // Step 1: Hide mining-sphere and show notice
  miningSphere.classList.add("hidden");
  notice.classList.remove("hidden");

  // Step 2: After 5 seconds, switch back
  setTimeout(() => {
    miningSphere.classList.remove("hidden");
    notice.classList.add("hidden");
  }, 20000); // 5000 milliseconds = 5 seconds
}

// Run the toggle function when the app is opened
toggleVisibility();
                        
</script>

  
  <!-- Theme toggle functionality - isolated from your main JavaScript -->
  <script src="main.js"></script>
  <script>
  const token = localStorage.getItem("token");
if (!token) {
  alert("Please log in to get started");
  window.location = "login.html";
}
    // Theme toggle functionality only - doesn't interfere with other elements
    document.getElementById('theme-toggle').addEventListener('click', function() {
      document.body.classList.toggle('light-theme');
      
      const icon = this.querySelector('i');
      if (document.body.classList.contains('light-theme')) {
        document.body.style.background = '#121212';
        document.body.style.color = '#121212';
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
      } else {
        document.body.style.background = '';
        document.body.style.color = '';
        icon.classList.remove('fa-sun');
        icon.classList.add('fa-moon');
      }
    });
  document.addEventListener("DOMContentLoaded", () => {
        initializePoints();
        fetchPoints();
       // resumeCountdown();
        // Restore session on page load
        checkPersistentLogin(); 
        console.log("checkPersistentLogin called");
        
          // DOM Elements
menuIcon.addEventListener("click", async (event) => {
  userInfoDropdown.classList.remove("hidden");
  event.stopPropagation(); // Prevent event from bubbling up to the document

  // Check if the user is online
  if (!navigator.onLine) {
    // Create and show offline notification
    const notification = document.createElement("div");
    notification.className = "offline-notification";
    notification.textContent = "You are currently offline";

    // Apply styles for WebView compatibility
    Object.assign(notification.style, {
      position: "absolute", // Works better in WebView
      top: window.scrollY + 20 + "px", // Adjust based on scroll position
      left: "50%",
      transform: "translateX(-50%)",
      backgroundColor: "#B8860B",
      color: "white",
      padding: "12px 24px",
      borderRadius: "4px",
      zIndex: "99999",
      boxShadow: "0 2px 10px rgba(0,0,0,0.2)",
      textAlign: "center",
      opacity: "1",
      transition: "opacity 0.5s ease",
    });

    document.body.appendChild(notification);
    document.body.offsetHeight; // Force reflow to ensure rendering

    // Remove notification after 3 seconds
    setTimeout(() => {
      notification.style.opacity = "0";
      setTimeout(() => {
        document.body.removeChild(notification);
      }, 500);
    }, 3000);

    return;
  }

  try {
    console.log("Menu icon clicked");

    // Retrieve token from localStorage
    const token = localStorage.getItem("token");
    if (!token) {
      alert("You must log in to view your referral link.");
      return;
    }
    console.log("Token retrieved:", token);

    // Fetch user details from backend
    const response = await fetch("https://maicoin-41vo.onrender.com/api/auth/details", {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    if (!response.ok) {
      alert("Failed to fetch user details. Please log in again.");
      localStorage.clear();
      window.location.reload();
      return;
    }


 /** 
menuIcon.addEventListener("click", async (event) => {  // Add (event) here
  userInfoDropdown.classList.remove("hidden");
  event.stopPropagation();
// Prevent event from bubbling up to the document
  
  
  try {
    console.log("Menu icon clicked");
    
    // Retrieve token from localStorage
    const token = localStorage.getItem("token");
    if (!token) {
      alert("You must log in to view your referral link.");
      return;
    }
    console.log("Token retrieved:", token);
    
    // Fetch user details from backend
    const response = await fetch("https://maicoin-41vo.onrender.com/api/auth/details", {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    
    if (!response.ok) {
      alert("Failed to fetch user details. Please log in again.");
      localStorage.clear();
      window.location.reload();
      return;
    }**/
    
    const user = await response.json();
    console.log("User details fetched:", user);

    const { username, email, balance, referrals, referralCode, name } = user;

    // Store the entire user object as JSON
localStorage.setItem("userData", JSON.stringify(user));

// Or store individual values with clear key names
localStorage.setItem("userEmail", email);
localStorage.setItem("username", username);
localStorage.setItem("balance", balance);
    const referralCount = referrals.length;
    localStorage.setItem("referralCount", referralCount);
    let streakLevel;
    if (referralCount < 5) streakLevel = "Regular";
    else if (referralCount < 10) streakLevel = "Intermediate";
    else if (referralCount < 20) streakLevel = "Partner";
    else if (referralCount < 30) streakLevel = "Advanced";
    else if (referralCount < 50) streakLevel = "Expert";
    else streakLevel = "Master";

      // Construct referral link
const referralLink = `Mai is an AI language model. Early users who complete daily tasks are rewarded with Mai ai crypto token, join using my referral link: https://www.maichain.site/login.html?ref=${referralCode}&redirect=playstore`;
console.log("Referral link constructed:", referralLink);
      localStorage.setItem("referralLink", referralLink);
      
      /**
const referralLink = `Mai is an AI language model. Early users who complete daily tasks are rewarded with Mai ai crypto token, join using my referral link: https://www.maichain.site/login.html?ref=${referralCode}`;
    console.log("Referral link constructed:", referralLink);**/

  // Default mining rate
const defaultRate = 0.0005;

// Get referral count from user data
//const referralCount = referrals.length;

// Calculate the bonus multiplier based on referrals (5% per referral)
const referralBonus = 1 + (referralCount * 0.05); // 5% boost per referral
      
       
// Optional: Cap the referral bonus multiplier to prevent extreme boosts
const cappedReferralBonus = Math.min(referralBonus, 5); // Max 500% bonus (5x multiplier)

// Calculate the dynamic mining rate
const miningRate = defaultRate * cappedReferralBonus;
      localStorage.setItem("miningRate", miningRate);

// Display mining rate
const miningRateDisplay = document.getElementById("mining-rate");
if (miningRateDisplay) {
  miningRateDisplay.textContent = `Mining Rate: ${miningRate.toFixed(5)} MAI/sec`;
}
      // Calculate new balance
    const currentBalance = parseFloat(localStorage.getItem("minedBalance")) || 0;
const newBalance = currentBalance + miningRate;

// Update balance in localStorage and UI
localStorage.setItem("minedBalance", newBalance.toFixed(4));
minedBalanceDisplay.textContent = `${newBalance.toFixed(4)} MAI`;
// Select Dropdown Points Display Element
const dropdownPointsDisplay = document.getElementById("dropdown-points");
      
      /**
 * Update Dropdown UI with Points
 */
function updatePointsUI(points) {
  if (dropdownPointsDisplay) {
    dropdownPointsDisplay.textContent = `${points.toFixed(2)} Points`;
  } else {
    console.warn("Dropdown points element not found in DOM.");
  }
}

      /**
 * Fetch Points from Backend and Update Dropdown
 */
async function initializePoints() {
  if (!token) {
    console.warn("No token found. Skipping points initialization.");
    return;
  }
  try {
    console.log("Initializing points on page load...");

    // Fetch points from backend
    const currentPoints = await fetchPoints();
    console.log("Current Points Fetched on Load:", currentPoints);

    if (typeof currentPoints === "number") {
      
      updatePointsUI(currentPoints); // Update Dropdown UI Immediately
    } else {
      console.warn("Points fetched are not a valid number.");
    }
  } catch (error) {
    console.error("Error initializing points:", error.message);
  }
}
      
      /**
 * Periodically Sync Points
 */
setInterval(async () => {
  if (token) {
    try {
      const currentPoints = await fetchPoints();
      updatePointsUI(currentPoints); // Update points periodically
    } catch (error) {
      console.error("Error syncing points:", error.message);
    }
  }
}, 60000); // Sync every 60 seconds

// Initialize Points on Page Load
document.addEventListener("DOMContentLoaded", () => {
  
});
      
      // Update dropdown content
userInfoDropdown.innerHTML = `
  <p class="text-center mb-2"><strong>MAI Chain</strong></p>
     <!-- <p class="mb-2">
    <i class="fas fa-id-card me-2"></i> 
    <a href="profile.html" class="text-decoration-none text-white">
        <strong>Profile</strong>
    </a>
</p>-->
  <p class="mb-2"><i class="fas fa-user me-2"></i> <strong>${name}</strong></p>
  <p class="mb-2"><i class="fas fa-user-tag me-2"></i> <strong>${username}</strong></p>
  <p class="mb-2"><i class="fas fa-envelope me-2"></i> 
      <a href="profile.html" class="text-decoration-none text-white">
      <strong>${email}</strong></p></a>
  <p class="mb-2"><i class="fas fa-fire me-2"></i> <strong>${streakLevel}</strong></p>
  <p class="mb-2"><i class="fas fa-cogs me-2"></i> <strong>${miningRate.toFixed(5)} MAI/sec</strong></p>
  <p class="mb-2"><i class="fas fa-wallet me-2"></i> <strong>${balance.toFixed(5)} MAI</strong></p>
  <p class="mb-2"><i class="fas fa-users me-2"></i> <strong>${referralCount} Referrals</strong></p>
      <p class="mb-2">
  <i class="fas fa-star me-2"></i> 
  <strong id="dropdown-points">0.00 Points</strong>
</p>
      <hr>
      <p><i class="fas fa-question-circle"></i> <strong><a href="more.html">About MAI</a></strong></p>
      <p><i class="fas fa-toolbox"></i> <strong><a href="more.html#utilities">Utilities</a></strong></p>
  <p><i class="fas fa-road"></i> <strong><a href="more.html#roadmap">Roadmap</a></strong></p>
  <p><i class="fas fa-file-alt"></i> <strong><a href="#">White Paper</a></strong></p>
      <p><i class="fas fa-question-circle"></i> <strong><a href="more.html#fag">FAQs</a></strong></p>
  <p><i class="fas fa-shield-alt"></i> <strong><a href="more.html#privacy-policy">Privacy Policy</a></strong></p>
      <hr>
      <p><i class="fas fa-link"></i> <strong>Referral Link:</strong></p>
  <button id="share-button"><i class="fas fa-share-alt"></i> Share</button>
  <button ><a style="color: white;" href="logout.html"><i class="fas fa-sign-out-alt"></i> Log Out</a></button>
      <br>
      <br>
      <button id="Support"><i class="fas fa-headset"></i><a href="task.html" style="color: white;">Contact Us</a></button>
    <p>v1.03</p>
`;
      userInfoDropdown.classList.toggle("active");
      
     const shareButton = document.getElementById("share-button");

// Define shareOnWhatsApp in the global scope
function shareOnWhatsApp() {
  const message = encodeURIComponent("" + referralLink);
  const whatsappUrl = `whatsapp://send?text=${message}`;

  // Try opening WhatsApp directly
  window.open(whatsappUrl, '_system');

  // Fallback to the browser if WhatsApp is not installed
  setTimeout(() => {
    const fallbackUrl = `https://api.whatsapp.com/send?text=${message}`;
    window.open(fallbackUrl, '_system'); // Open in system browser
  }, 500); // Wait 500ms to check if WhatsApp opened
}

if (shareButton) {
  shareButton.addEventListener("click", () => {
    // Toggle the "clicked" class to change color to dark green
    shareButton.classList.toggle("clicked");

    // Show or hide share options
    const existingShareOptions = document.getElementById("share-options");
    if (existingShareOptions) {
      // If share options exist, hide them
      existingShareOptions.remove();
    } else {
      // If share options do not exist, show them directly below the share button
      const shareOptions = `
        <div id="share-options" style="margin-top: 10px;">
          <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(referralLink)}" target="_blank">Share on Facebook</a><br>
          <a href="#" id="whatsapp-share">Share on WhatsApp</a><br>
          <a href="https://www.instagram.com/" target="_blank">Share on Instagram</a><br> 
<button id="copy-link">Copy Link</button>
        </div>
      `;

      // Insert the share options directly below the share button
      shareButton.insertAdjacentHTML("afterend", shareOptions);

      // Add event listener for the WhatsApp share link
      const whatsappShareLink = document.getElementById("whatsapp-share");
      if (whatsappShareLink) {
        whatsappShareLink.addEventListener("click", (e) => {
          e.preventDefault(); // Prevent default link behavior
          shareOnWhatsApp(); // Call the shareOnWhatsApp function
        });
      }
      // Add copy link functionality after appending the link
      const copyLinkButton = document.getElementById("copy-link");
      if (copyLinkButton) {
        copyLinkButton.addEventListener("click", () => {
          navigator.clipboard
            .writeText(referralLink)
            .then(() => alert("Referral link copied to clipboard!"))
            .catch((err) => console.error("Failed to copy referral link:", err));
        });
      }
    }
  });
} 
  


         
      
      // Close dropdown when clicking outside
document.addEventListener("click", (event) => {
  if (
    userInfoDropdown.classList.contains("active") &&
    !userInfoDropdown.contains(event.target) && // Check if clicked outside dropdown
    event.target !== menuIcon // Check if clicked is not the menu icon
  ) {
    userInfoDropdown.classList.remove("active");
  }
});
    
    // Add logout functionality
    const logoutButton = document.getElementById("logout-button");
      if (logoutButton) {
      logoutButton.addEventListener("click", () => {
        localStorage.clear();
        alert("Logged out successfully.");
        window.location.reload();
      });
    }
  } catch (error) {
    console.error("Error toggling menu:", error);
    alert("An error occurred while fetching user details.");
  }
});
  
  // Function to fetch the user data (adjust based on your API)
async function fetchUserData() {
  try {
    // Assuming you have a token stored in localStorage for authentication
    const token = localStorage.getItem("token");
    if (!token) {
      console.error("No token found. Please log in.");
      return;
    }
    
    // Make an API call to fetch the user's referral data (replace with your actual API endpoint)
    const response = await fetch("https://maicoin-41vo.onrender.com/api/auth/details", {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });
    if (!response.ok) {
      throw new Error("Failed to fetch user data");
    }

    const userData = await response.json();

    // Assuming the response contains a 'referrals' array
    const referrals = userData.referrals || []; // Fallback to empty array if not found
    // Now calculate the streak level dynamically based on referral count
    const referralCount = referrals.length;
    localStorage.setItem("referralCount", referralCount);
    
    let streakLevel;
    if (referralCount < 5) streakLevel = "Regular";
    else if (referralCount < 10) streakLevel = "Intermediate";
    else if (referralCount < 20) streakLevel = "Partner";
    else if (referralCount < 30) streakLevel = "Advanced";
    else if (referralCount < 50) streakLevel = "Expert";
    else streakLevel = "Master";
      
      // Populate the streak level in the dashboard
    const streakLevelContainer = document.getElementById("streak-level-container");

    if (streakLevelContainer) {
      streakLevelContainer.innerHTML = `
        <div class="streak-level">
          <span id="current-streak-level">Level: <strong>${streakLevel}</strong></span>
          <button id="streak-dropdown-toggle">â–¼</button>
        </div>
        <div id="streak-dropdown" class="hidden">
          <ul>
            <li>Regular</li>
            <li>Intermediate</li>
            <li>Partner</li>
            <li>Advanced</li>
            <li>Expert</li>
            <li>Master</li>
          </ul>
        </div>
      `;
    }
      // Add event listener for dropdown toggle
    const streakDropdownToggle = document.getElementById("streak-dropdown-toggle");
    const streakDropdown = document.getElementById("streak-dropdown");

    if (streakDropdownToggle) {
      streakDropdownToggle.addEventListener("click", () => {
        event.stopPropagation(); // Prevent the click from propagating to the document
        streakDropdown.classList.toggle("hidden");
        // Change button text based on dropdown visibility
        if (streakDropdown.classList.contains("hidden")) {
          streakDropdownToggle.textContent = "â–¼";
        } else {
          streakDropdownToggle.textContent = "â–²";
                  }
      });
    }
  } catch (error) {
    console.error("Error fetching user data:", error);
  }
}
  // Call the function to load user data on page load
fetchUserData(); 

  const taskButton = document.getElementById("task-button");
if (taskButton) {
  taskButton.addEventListener("click", () => {
    window.location.href = "news.html";
  });
}

    
  });
  
    const dashboard = document.getElementById("dashboard");
  const activateMiningButton = document.getElementById("activate-mining");
 // const progressCircle = document.getElementById("progress-circle");
  const minedBalanceDisplay = document.getElementById("mined-balance");
  const userNameDisplay = document.getElementById("user-name");
  const menuIcon = document.getElementById("menu-icon");
  const userInfoDropdown = document.getElementById("user-info-dropdown");
  const formTitle = document.getElementById("form-title");
  const nameInput = document.getElementById("name");
  const usernameInput = document.getElementById("username");
  const emailInput = document.getElementById("email");
  const formContainer = document.getElementById("form-container");
  const miningCountdown = document.getElementById("mining-countdown");
  
   // State Variables
  let isMiningActive = false;
  let miningProgress = 0;
  let miningInterval;
  let countdownInterval;
    
    function restoreMiningSession(userId) {
    const miningEndTime = parseInt(getUserMiningData(userId, "miningEndTime")) || 0;
    const now = Date.now();

    if (miningEndTime > now && getUserMiningStatus(userId)) {
        const remainingTime = miningEndTime - now;
        startCountdown(remainingTime);
        startMiningProcess(remainingTime);
    } else if (miningEndTime <= now && getUserMiningStatus(userId)) {
        // Mining should have finished while app was closed
        resetMiningSession(userId, false); // Don't show alert for expired sessions
    }
}
    
  
// âœ… Always allow login if token exists in localStorage
function checkPersistentLogin() {
    let token = localStorage.getItem("token");

    if (!token) {
        console.warn("No access token found. User must log in.");
        return;
    }

    // âœ… Directly allow user access if token is present
    document.getElementById("form-container").classList.add("hidden");
    dashboard.classList.remove("hidden");

    // âœ… Background sync: Fetch latest user data
    syncUserData();
}

// âœ… Function to sync user data with backend
async function syncUserData() {
    const token = localStorage.getItem("token");

    if (!token) return;

    try {
        const response = await fetch("https://maicoin-41vo.onrender.com/api/auth/details", {
            method: "GET",
            headers: {
                "Authorization": `Bearer ${token}`,
                "Content-Type": "application/json"
            },
            credentials: "include"
        });

        if (!response.ok) {
            console.warn("Failed to sync user data.");
            return;
        }

        const userData = await response.json();
        localStorage.setItem("username", userData.username);
        localStorage.setItem("email", userData.email);
        localStorage.setItem("minedBalance", userData.balance.toFixed(4));

        userNameDisplay.textContent = userData.username;
        minedBalanceDisplay.textContent = `${userData.balance.toFixed(4)} MAI`;

    } catch (error) {
        console.error("Error syncing user data:", error);
    }
}


// âœ… Function to refresh token when it expires
async function refreshAuthToken() {
    try {
        const response = await fetch("https://maicoin-41vo.onrender.com/api/auth/refresh", {
            method: "POST",
            credentials: "include"
        });

        if (!response.ok) {
            console.warn("Refresh token request failed.");
            return null;
        }

        const data = await response.json();
        if (data.token) {
            localStorage.setItem("token", data.token); // Save new access token
            console.log("Token refreshed successfully.");
            return data.token;
        }
        return null;

    } catch (error) {
        console.error("Error refreshing token:", error);
        return null;
    }
}

// âœ… Function to check if JWT token is expired
function isTokenValid(token) {
    try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        const expiry = payload.exp * 1000; // Convert to milliseconds
        return Date.now() < expiry;
    } catch (error) {
        console.error("Invalid token format:", error);
        return false;
    }
}

  
  // Redirect for desktop users
  const isDesktop = window.innerWidth > 768;

  if (isDesktop) {
    // Redirect to the news page
    window.location.href = "./news.html";
  }
  
  const powText = document.getElementById('pow-text');
const messageBox = document.getElementById('message-box');
/**
// For mouse devices (desktop)
powText.addEventListener('mousedown', function() {
  messageBox.style.display = 'block'; // Show message
});

powText.addEventListener('mouseup', function() {
  messageBox.style.display = 'none'; // Hide message
});

powText.addEventListener('mouseleave', function() {
  messageBox.style.display = 'none'; // Hide message if mouse leaves
});

// For touch devices (mobile)
powText.addEventListener('touchstart', function() {
  messageBox.style.display = 'block'; // Show message
});
  
  powText.addEventListener('touchend', function() {
  messageBox.style.display = 'none'; // Hide message
});

powText.addEventListener('touchcancel', function() {
  messageBox.style.display = 'none'; // Hide message if touch is canceled
});**/
  
  // Authentication Token (Replace with actual user token retrieval logic)


// User Activity Tracking
let isUserActive = false;
let lastActiveTime = Date.now();

// Track User Activity
document.addEventListener("scroll", () => {
  isUserActive = true;
  lastActiveTime = Date.now();
});

document.addEventListener("click", () => {
  isUserActive = true;
  lastActiveTime = Date.now();
});
  
  // UI Elements for Displaying Points
//const dropdownPointsDisplay = document.getElementById("dropdown-points");
const dashboardPointsDisplay = document.getElementById("dashboard-points");
  
  async function fetchPoints() {
  if (!token) {
    console.error("Missing authorization token");
    return 0; // Return 0 points if no token
  }

  try {
    console.log("Fetching points from backend...");

    const response = await fetch("https://maicoin-41vo.onrender.com/api/points", {
      method: "GET",
      headers: {
        Authorization: `Bearer ${token}`,
      },
    });

    console.log("Response status:", response.status);

    if (!response.ok) {
      throw new Error("Failed to fetch points");
    }

    const data = await response.json();
    console.log("Fetched points data object:", data);
    
    // Ensure correct access to points
    if (data && data.success && typeof data.points === "number") {
      console.log("Points fetched successfully:", data.points);
      return data.points;
    } else {
      throw new Error("Invalid response structure: 'points' not found");
    }
  } catch (error) {
    console.error("Error fetching points:", error.message);
    return 0;
  }
}
  
  /**
 * Update Points on Backend
 */
async function updatePoints(increment) {
  if (!token) {
    console.error("Missing authorization token");
    return 0;
  }

  try {
    const response = await fetch("https://maicoin-41vo.onrender.com/api/points", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${token}`,
      },
      body: JSON.stringify({ increment }),
    });
    
    if (!response.ok) {
      throw new Error("Failed to update points");
    }

    const data = await response.json();
    if (data.success) {
      return data.points;
    } else {
      throw new Error(data.message || "Failed to update points");
    }
  } catch (error) {
    console.error("Error updating points:", error.message);
    return 0;
  }
}
  
  /**
 * Update UI with Points
 */
function updatePointsUI(points) {
  const dashboardPointsDisplay = document.getElementById("dashboard-points");
  const dropdownPointsDisplay = document.getElementById("dropdown-points");

  if (dashboardPointsDisplay) {
    dashboardPointsDisplay.textContent = `${points.toFixed(2)} Points`;
    console.log("Dashboard Points Updated:", points);
  } else {
    console.warn("Dashboard points display element not found.");
  }

  if (dropdownPointsDisplay) {
    dropdownPointsDisplay.textContent = `${points.toFixed(2)} Points`;
    console.log("Dropdown Points Updated:", points);
  } else {
    console.warn("Dropdown points display element not found.");
  }
}
  
  /**
 * Initialize Points on Page Load and Maintain Sync
 */
let currentPoints = 0;

async function initializePoints() {
  if (!token) {
    console.warn("No token found. Skipping points initialization.");
    return;
  }

  try {
    console.log("Initializing points on page load...");

    // Fetch points from backend on page load
    currentPoints = await fetchPoints();
    console.log("Fetched Points on Load:", currentPoints);

    // Immediately update the UI
    if (typeof currentPoints === "number") {
      updatePointsUI(currentPoints);
    } else {
      console.warn("Fetched points are not a valid number.");
    }
    
    // Start periodic synchronization every 10 seconds
    setInterval(async () => {
      try {
        const latestPoints = await fetchPoints();
        console.log("Fetched points during sync:", latestPoints);

        if (latestPoints !== currentPoints) {
          currentPoints = latestPoints;
          updatePointsUI(currentPoints);
        }
      } catch (error) {
        console.error("Error syncing points:", error.message);
      }
    }, 60000); // Sync every 1 seconds

  } catch (error) {
    console.error("Error initializing points:", error.message);
  }
}
  
  /**
 * Increment Points Based on User Activity
 */
let pointsIncrementInterval = setInterval(async () => {
  if (isUserActive && (Date.now() - lastActiveTime) < 15000) {
    try {
      const newPoints = await updatePoints(0.1); // Increment backend points by 0.1
      currentPoints = newPoints; // Update local points
      updatePointsUI(currentPoints); // Reflect in UI
    } catch (error) {
      console.error("Error incrementing points:", error.message);
    }
  }
  isUserActive = false; // Reset activity state
}, 20000);
  /**
  // **Restore Mining Session**
  function restoreMiningSession() {
    const savedProgress = parseInt(localStorage.getItem("miningProgress")) || 0;
    const miningEndTime = parseInt(localStorage.getItem("miningEndTime")) || 0;
    const now = Date.now();

    if (savedProgress < 100 && miningEndTime > now) {
      continueMining(savedProgress, miningEndTime - now);
      startCountdown(miningEndTime - now);
    } else {
      localStorage.removeItem("miningProgress");
      localStorage.removeItem("miningEndTime");
      activateMiningButton.textContent = "Activate Mining";
      activateMiningButton.disabled = false;
    }**/
  
  /**
    // **Start Countdown Timer with Progress Circle Sync**
function startCountdown(remainingTime, totalTime) {
    if (countdownInterval) clearInterval(countdownInterval);

    const startTime = Date.now();
    const endTime = startTime + remainingTime;

    // Save endTime and totalTime in localStorage
    localStorage.setItem('countdownEndTime', endTime);
    localStorage.setItem('countdownTotalTime', totalTime || remainingTime);

    countdownInterval = setInterval(() => {
        const currentTime = Date.now();
        const timeLeft = endTime - currentTime;

        if (timeLeft <= 0) {
            clearInterval(countdownInterval);
            
          miningCountdown.textContent = "Next session available!";
        }
  /**          progressCircle.style.background = `conic-gradient(#2C3E30 100%, #718074 100%)`;
            localStorage.removeItem('countdownEndTime');
            localStorage.removeItem('countdownTotalTime');
        } else {
            const minutes = Math.floor(timeLeft / (60 * 1000));
            const seconds = Math.floor((timeLeft % (60 * 1000)) / 1000);
  
          miningCountdown.textContent = `Next session: ${minutes}m ${seconds}s`;

            // Update Progress Circle
            const totalTimeStored = parseInt(localStorage.getItem('countdownTotalTime'), 10);
            const progressPercentage = ((totalTimeStored - timeLeft) / totalTimeStored) * 100;
            progressCircle.style.background = `conic-gradient(
                #2C3E30 ${progressPercentage}%, 
                #718074 ${progressPercentage}% 100%
            )`;
        }
    }, 1000);
}
  
  function resumeCountdown() {
    const endTime = parseInt(localStorage.getItem('countdownEndTime'), 10);
    const totalTime = parseInt(localStorage.getItem('countdownTotalTime'), 10);

    if (endTime && totalTime) {
        const currentTime = Date.now();
        const remainingTime = endTime - currentTime;

        if (remainingTime > 0) {
            // Calculate the already elapsed time
            const elapsedTime = totalTime - remainingTime;
            const progressPercentage = (elapsedTime / totalTime) * 100;

            // Start Countdown with the correct remaining time
            startCountdown(remainingTime, totalTime);
          // Sync Progress Circle Immediately
            progressCircle.style.background = `conic-gradient(
                #2C3E30 ${progressPercentage}%, 
                #718074 ${progressPercentage}% 100%
            )`;
        } else {
            // Timer expired
            localStorage.removeItem('countdownEndTime');
            localStorage.removeItem('countdownTotalTime');
            miningCountdown.textContent = "Next session available!";
            progressCircle.style.background = `conic-gradient(#2C3E30 100%, #718074 100%)`;
        }
    }
}**/
  

      </script>
  <script src="appg.js"></script>
</body>
</html>